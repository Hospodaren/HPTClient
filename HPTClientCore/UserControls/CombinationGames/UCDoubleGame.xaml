<HPT:UCCombBetControl x:Class="HPTClient.UCDoubleGame"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:HPT="clr-namespace:HPTClient"
    xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
    DataContext="{Binding RelativeSource={RelativeSource Self}}"
    x:Name="ucDoubleGame"
    Loaded="ucDoubleGame_Loaded">
    <UserControl.Resources>

        <DataTemplate x:Key="RaceContentTemplate">

            <GroupBox Background="{StaticResource BackgroundBrush}" BorderBrush="Black" HeaderTemplate="{StaticResource GroupBoxHeaderTemplate}" Header="{Binding LegNrString}"  Grid.Row="1"
                      DataContext="{Binding DataContext,RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ContentControl}}}">
                <Grid Width="Auto">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="20" />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Horizontal" Grid.Row="0">
                        <TextBlock Text="{Binding RaceInfoShort}" Margin="2,2,10,2" FontWeight="Bold">
                            <TextBlock.ToolTip>
                                <ToolTip Background="{StaticResource BackgroundBrush}" ToolTipService.ShowDuration="20000" DataContext="{Binding Path=PlacementTarget.DataContext, RelativeSource={x:Static RelativeSource.Self}}">
                                    <Border BorderBrush="Black" BorderThickness="1" Margin="2">
                                        <TextBlock Text="{Binding RaceInfoLong}" Style="{StaticResource tbStyle}"  Margin="2"/>
                                    </Border>
                                </ToolTip>
                            </TextBlock.ToolTip>
                    </TextBlock>
                        <TextBlock Text="{Binding RaceName}" Margin="10,2,2,2">
                            <TextBlock.ToolTip>
                                <ToolTip Background="{StaticResource BackgroundBrush}" ToolTipService.ShowDuration="20000" DataContext="{Binding Path=PlacementTarget.DataContext, RelativeSource={x:Static RelativeSource.Self}}">
                                    <Border BorderBrush="Black" BorderThickness="1" Margin="2">
                                        <TextBlock Text="{Binding RaceInfoLong}" Style="{StaticResource tbStyle}" Margin="2"/>
                                    </Border>
                                </ToolTip>
                            </TextBlock.ToolTip>
                    </TextBlock>
                    </StackPanel>
                    <HPT:UCRaceView Grid.Row="1" DataContext="{Binding}"/>
                </Grid>
            </GroupBox>

        </DataTemplate>
       
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition/>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>
        
        <!--Races-->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition/>
                <RowDefinition Height="Auto"/>
                <RowDefinition/>
            </Grid.RowDefinitions>

            <Border BorderThickness="1" BorderBrush="Black">
                <StackPanel Orientation="Horizontal">

                    <xctk:WatermarkTextBox x:Name="mtbSystemName" Watermark="Ange eget namn på systemet..." 
                                       Text="{Binding Path=CombBet.SystemName,UpdateSourceTrigger=PropertyChanged}" MinWidth="200"/>

                    <TextBlock x:Name="txtCountdownInfo" Margin="8,2,2,2" FontWeight="Bold"/>
                    <TextBlock x:Name="txtCountdownTimer" Margin="2"/>

                    <TextBlock Margin="12,2,2,2" Text="Omsättning: " FontWeight="Bold"/>
                    <TextBlock Margin="2" Text="{Binding Path=CombBet.RaceDayInfo.Turnover,StringFormat={}{0:N0} kr,ConverterCulture=sv-SE}"/>

                </StackPanel>

            </Border>

            <ContentControl ContentTemplate="{StaticResource RaceContentTemplate}" DataContext="{Binding Race1}" Grid.Row="1"/>
            <GridSplitter Grid.Row="2" BorderBrush="Black" BorderThickness="1" ResizeBehavior="BasedOnAlignment" ResizeDirection="Rows" VerticalAlignment="Center" HorizontalAlignment="Stretch" Background="{StaticResource SelectedBrush}" Height="4" Margin="1"/>
            <ContentControl ContentTemplate="{StaticResource RaceContentTemplate}" DataContext="{Binding Race2}" Grid.Row="3"/>
        </Grid>

        <GridSplitter BorderBrush="Black" BorderThickness="1" Grid.Column="1" VerticalAlignment="Stretch" HorizontalAlignment="Center" ResizeBehavior="BasedOnAlignment" ResizeDirection="Columns" Background="{StaticResource SelectedBrush}" Width="4" Margin="1"/>
        
        <Grid Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <HPT:UCCombinationView CombBet="{Binding Path=CombBet,ElementName=ucDoubleGame}" 
                                   DataContext="{Binding Path=CombBet.RaceDayInfo.CombinationListInfoDouble,ElementName=ucDoubleGame}"/>

            <HPT:UCCombinationsGameHandling CombBet="{Binding CombBet,ElementName=ucDoubleGame}" DataContext="{Binding Path=CombBet.RaceDayInfo.CombinationListInfoDouble,ElementName=ucDoubleGame}" Grid.Row="1"/>

        </Grid>
    </Grid>
</HPT:UCCombBetControl>
